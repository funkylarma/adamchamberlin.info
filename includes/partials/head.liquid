<meta charset="utf-8">

<!-- Title -->
<title>{% if title %}{{ title | metaTitle }}{% else %}{{ metadata.title }}{% endif %}</title>

{% if metadata.env == "production" %}
  <!-- Inlined critical styles -->
  {% css %}
  {% renderFile "./src/assets/css/critical.scss" %}
  {% endcss %}
  <style>{% getBundle "css" %}</style>
  <!-- Preloads -->
  <link rel="preload" href="{{ '/assets/fonts/plus-jakarta-sans-v8-latin-regular.woff2' | url }}" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="{{ '/assets/css/screen.css' | url | fileHash }}" as="style" onload="this.onload=null;this.rel='stylesheet'" crossorigin>
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.0.1/dist/cookieconsent.css" as="style" onload="this.onload=null;this.rel='stylesheet'" crossorigin>
  <!-- Preconnects -->
  <link rel="preconnect" href="https://www.google-analytics.com/" crossorigin="anonymous">
  <!-- Prefetch -->
  <link rel="dns-prefetch" href="https://www.google-analytics.com/">
  <!-- Non-critical styles -->
  <link rel="stylesheet" href="/assets/css/screen.css" media="all" onload="this.media='all'" fetchpriority="low">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.0.1/dist/cookieconsent.css" media="all" onload="this.media='all'" fetchpriority="low">
  <noscript>
  <link rel="stylesheet" href="{{ '/assets/css/screen.css' | url | fileHash }}" fetchpriority="low">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.0.1/dist/cookieconsent.css" fetchpriority="low">
  </noscript>
{% else %}
  <link rel="stylesheet" href="/assets/css/screen.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.0.1/dist/cookieconsent.css">
{% endif %}

<!-- Meta Details -->
{%- comment -%}Prevent this page from showing up on search engines{%- endcomment -%}
{%- if noindex -%}
  <meta name="robots" content="noindex">
{%- else -%}
  <meta name="robots" content="index, follow" />
{%- endif -%}
{% if tags.length > 0 %}
  <meta name="keywords" content="{{ tags | metaKeywords }}">
{% endif %}
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="generator" content="{{ eleventy.generator }}" />
<meta name="author" content="{{ metadata.author.name }}">
<meta name="description" content="{% if description %}{{ description }}{% else %}{{ title | metaDescription }}{% endif %}" />
<meta property="article:author" content="{{ metadata.author.name }}">

<!-- Icons and Feeds -->
<link rel="author" href="{{ "/humans.txt" | absoluteUrl }}" type="text/plain" />
<link rel="alternate" href="{{ metadata.feed.path | absoluteUrl }}" type="application/atom+xml" title="{{ metadata.title }}">
<link rel="alternate" href="{{ metadata.jsonfeed.path | absoluteUrl }}" type="application/json" title="{{ metadata.title }}">
<link rel="canonical" href="{{ page.url | absoluteUrl }}" />
<link rel="icon" type="image/png" href="{{ "/assets/icons/favicon-96x96.png" | absoluteUrl }}" sizes="96x96" />
<link rel="icon" type="image/png" href="{{ "/assets/icons/web-app-manifest-192x192.png" | absoluteUrl }}" sizes="192x192" />
<link rel="icon" type="image/svg+xml" href="{{ "/assets/icons/favicon.svg" | absoluteUrl }}" />
<link rel="shortcut icon" href="{{ "/assets/icons/favicon.ico" | absoluteUrl }}" />
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png" />
<link rel="manifest" href="{{ "/web.manifest" | absoluteUrl }}" />

<!-- Fediverse -->
<meta name="fediverse:creator" content="@funkylarma@mastodon.social">

<!-- OpenGraph -->
<meta property="og:title" content="{% if title %}{{ title | metaTitle }}{% else %}{{ metadata.title }}{% endif %}" />
<meta property="og:url" content="{{ page.url | absoluteUrl }}" />
<meta property="og:description" content="{% if description %}{{ description }}{% else %}{{ title | metaTitle }}{% endif %}" />
<meta property="og:locale" content="en_GB" />
<meta property="og:type" content="article" />
{% if tags %}
<meta property="og:image" content="{{ metadata.url }}assets/ogi/{{ date | dateParse }}-{{ title | slugify }}.jpeg" />
<meta property="og:image:secure_url" content="{{ metadata.url }}assets/ogi/{{ date | dateParse }}-{{ title | slugify }}.jpeg" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
{% else %}
<meta property="og:image" content="{{ metadata.url }}assets/images/og.png" />
<meta property="og:image:secure_url" content="{{ metadata.url }}assets/images/og.png" />
{% endif %}

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@funkylarma" />
<meta name="twitter:title" content="{% if title %}{{ title }}{% else %}{{ metadata.title }}{% endif %}" />
<meta name="twitter:description" content="{% if description %}{{ description }}{% else %}{{ title }}{% endif %}" />
{% if tags %}
  <meta name="twitter:image" content="{{ metadata.url }}assets/ogi/{{ date }}-{{ title | slugify }}.jpeg" />
{% else %}
  <meta name="twitter:image" content="{{ metadata.url }}assets/images/og.png" />
{% endif %}

<!-- Used to add dark mode right away, adding here prevents any flicker -->
<script>
  {% capture jshead %}
  const cachedTheme = localStorage.getItem('ac_theme');
  if (cachedTheme) {
    document.documentElement.dataset['ac_theme'] = cachedTheme;
  }
  {% endcapture %}
  {% if metadata.env == "production" %}
    {{ jshead | jsmin }}
  {% else %}
    {{ jshead }}
  {% endif %}
</script>

{% if metadata.env == "production" %}
  <!-- Google tag (gtag.js) -->
  <script defer src="https://www.googletagmanager.com/gtag/js?id={{ env.GA4_TAG }}" type="text/plain" data-category="analytics" data-service="Google Analytics"></script>
  <script defer>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', '{{ env.GA4_TAG }}');
  </script>
{% endif %}
